DROP TABLE IF EXISTS __tmp_pengaduan;
CREATE TABLE __tmp_pengaduan AS
SELECT
@id:=@id+1 AS id,
p.nomor,
p.`kategori`
FROM pengaduan p
JOIN `__tmp_tipepermohonan` t ON t.`kodejenisnonair`=p.`kategori`
,(SELECT @id:=@lastid) AS id
WHERE `flaghapus`=0 AND `flagpel`=1;

SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'Diameter Baru' AS `parameter`,
'int' AS `tipedata`,
NULL AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
NULL AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL
UNION ALL
SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'Keterangan Lapangan' AS `parameter`,
'string' AS `tipedata`,
LEFT(b.`uraianpenyelesaian`,250) AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
NULL AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL
UNION ALL
SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'Merk Meter Baru' AS `parameter`,
'int' AS `tipedata`,
NULL AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
NULL AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL
UNION ALL
SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'Meteran Diganti' AS `parameter`,
'string' AS `tipedata`,
NULL AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
NULL AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL
UNION ALL
SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'No Segel Baru' AS `parameter`,
'string' AS `tipedata`,
NULL AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
NULL AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL
UNION ALL
SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'Serimeter Baru' AS `parameter`,
'string' AS `tipedata`,
NULL AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
NULL AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL
UNION ALL
SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'Tanggal Pengerjaan Akhir' AS `parameter`,
'date' AS `tipedata`,
NULL AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
b.`tglpekerjaan2` AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL
UNION ALL
SELECT
@idpdam AS `idpdam`,
p.`id` AS `idpermohonan`,
'Tanggal Pengerjaan Awal' AS `parameter`,
'date' AS `tipedata`,
NULL AS `valuestring`,
NULL AS `valuedecimal`,
NULL AS `valueinteger`,
b.`tglpekerjaan1` AS `valuedate`,
NULL AS `valuebool`,
b.`tgldiselesaikan` AS `waktuupdate`
FROM __tmp_pengaduan p
JOIN `spk_pengaduan` b ON b.`nomorpengaduan`=p.`nomor`
WHERE p.`kategori` IN (
'JNS-29',
'JNS-113',
'JNS-100',
'JNS-102',
'JNS-103',
'JNS-31',
'JNS-104',
'JNS-105',
'JNS-106',
'JNS-108',
'JNS-119',
'JNS-109',
'JNS-111',
'JNS-114',
'JNS-117',
'JNS-118',
'JNS-121',
'JNS-123',
'JNS-124',
'JNS-115',
'JNS-19',
'JNS-126',
'JNS-127',
'JNS-128',
'JNS-129',
'JNS-130',
'JNS-131',
'JNS-132',
'JNS-133',
'JNS-134',
'JNS-135',
'JNS-136',
'JNS-137',
'JNS-138',
'JNS-142',
'JNS-143',
'JNS-146',
'JNS-148',
'JNS-150'
) AND b.`flaghapus`=0 AND b.`nomorba` IS NOT NULL AND b.`tgldiselesaikan` IS NOT NULL